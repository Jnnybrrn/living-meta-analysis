<!doctype html>
<title>User Profile | Living Meta-Analysis</title>
<script src="/lib/promise.js"></script>
<script src="/lib/fetch.js"></script>
<script src="https://apis.google.com/js/platform.js"></script>
<link rel="stylesheet" href="/css/main.css">

redirecting...

<script src="/js/tools.js"></script>
<script src="/js/auth.js"></script>

<script>
window.lima.initPage = function initPage() {
  // redirect to the user's profile

  var loggedIn = lima.getAuthenticatedUserEmail();
  var user;

  if (loggedIn) {
    lima.getGapiIDToken()
    .then(function (idToken) {
      return fetch('/api/profile/' + loggedIn, lima._.idTokenToFetchOptions(idToken));
    })
    .then((res) => {
      console.log(res);
      if (res.status === 200) { // user exists
        user = loggedIn;
      } else {
        user = 'lima@local';
      }
      window.history.replaceState({}, "profile", '/' + user +'/');
      window.location.href = '/' + user +'/';
    })
    .catch((err) => {
      console.log(err);
      console.error("profile didn't respond too well.")
    });
  } else {
    window.history.replaceState({}, "signin", '/signin');
    window.location.href = '/signin';
  }

}
</script>
