<!doctype html>
<title>User Profile | Living Meta-Analysis</title>
<script src="/lib/promise.js"></script>
<script src="/lib/fetch.js"></script>
<script src="https://apis.google.com/js/platform.js"></script>
<link rel="stylesheet" href="/css/main.css">

redirecting...

<script src="/js/tools.js"></script>
<script src="/js/auth.js"></script>

<script>
window.lima.initPage = function initPage() {
  // redirect to the user's profile

  var loggedIn = lima.getAuthenticatedUserEmail();
  var user;

  if (loggedIn) {
    lima.getGapiIDToken()
    .then(function (idToken) {
      return fetch('/api/known/' + loggedIn, {
        method: 'GET',
        headers: lima._.idTokenToFetchHeaders(idToken),
      });
    })
    .then(function (res) {
      if (res.status !== 403) {
        user = loggedIn;
      } else {
        return Promise.reject();
      }
    })
    .catch(function(err) {
      // todo: do we handle this?
      console.error(err);
    })
    .then(function() {
      window.history.replaceState({}, "profile", '/' + user +'/');
      window.location.href = '/' + user +'/';
    });
  } else {
    window.history.replaceState({}, "signin", '/signin');
    window.location.href = '/signin';
  }

}
</script>
